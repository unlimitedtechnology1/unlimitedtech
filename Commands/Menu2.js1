const util = require('util');
const fs = require('fs-extra');
const { zokou } = require(__dirname + "/../framework/zokou");
const moment = require("moment-timezone");
const s = require(__dirname + "/../set");
const more = String.fromCharCode(8206);
const readmore = more.repeat(4001);

// Menu Command
zokou({ nomCom: "menu1", categorie: "General" }, async (dest, zk, commandeOptions) => {
    const { ms, repondre, nomAuteurMessage } = commandeOptions;
    const { cm } = require(__dirname + "/../framework//zokou");

    let coms = {};
    let mode = (s.MODE.toLocaleLowerCase() === "yes") ? "public" : "private";

    // Grouping commands by category
    cm.forEach(com => {
        if (!coms[com.categorie]) coms[com.categorie] = [];
        coms[com.categorie].push(com.nomCom);
    });

    // Set timezone and format time
    moment.tz.setDefault('Etc/GMT');
    const currentTime = moment().format('HH:mm:ss');
    const currentDate = moment().format('DD/MM/YYYY');

    // Context Info
    let infoMsg = `
â•­â•â•ã€Š *${s.BOT}* ã€‹â•â•â•â•âŠ·â
â”ƒââ•­â•â•â•â•â•â•â•â•â•â•âŠ·âŠ·
â”ƒââ”‚â–¸ ğ—¢ğ˜„ğ—»ğ—²ğ—¿ : ${s.OWNER_NAME}
â”ƒââ”‚â–¸ ğ—£ğ—¿ğ—²ğ—³ğ—¶ğ˜… : [ ${s.PREFIXE} ] 
â”ƒââ”‚â–¸ ğ— ğ—¼ğ—±ğ—² : *${mode}*
â”ƒââ”‚â–¸ ğ——ğ—®ğ˜ğ—²  : *${date}* 
â”ƒââ”‚â–¸ ğ—¥ğ—®ğ—º : ğŸ´/ğŸ­ğŸ¯ğŸ® ğ—šğ—•
â”ƒââ”‚â–¸ ğ—£ğ—¹ğ—®ğ˜ğ—³ğ—¼ğ—¿ğ—º : ğ—–ğ—µğ—¿ğ—¼ğ—ºğ—² ğ—Ÿğ—¶ğ—»ğ˜‚ğ˜…
â”ƒââ”‚â–¸ ğ—–ğ—¿ğ—²ğ—®ğ˜ğ—¼ğ—¿ : ğš‚ğšƒğ™°ğ™¼ğšˆ-á´›á´‡á´„Êœ
â”ƒââ•°â•â•â•â•â•â•â•â•â•â•âŠ·âŠ·
â•°â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•âŠ·â `;

    // Generate Menu Content
    let menuMsg = `*ğš‚ğšƒğ™°ğ™½ğšˆ á´›á´‡á´„Êœ*\n`;
    for (const cat in coms) {
        menuMsg += `
â•­â•â•ã€Œ *${cat}* ã€â•â•â•âŠ·â
â”ƒâ•­â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•âŠ·â
${coms[cat].map(cmd => `â”ƒâ”‚â  ${cmd}`).join("\n")}
â”ƒâ•°â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•âŠ·â
â•°â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•âŠ·â`;
    }
    menuMsg += `
> ğš‚ğšƒğ™°ğ™¼ğšˆ á´›á´‡á´„Êœ\n`;

    try {
        // Send Menu with Context Info
        await zk.sendMessage(dest, { 
            text: infoMsg + menuMsg,
            contextInfo: {
                mentionedJid: [nomAuteurMessage],
                externalAdReply: {
                    body: "Â©ğš‚ğšƒğ™°ğ™½ğšˆ á´›á´‡á´„Êœ",
                    thumbnailUrl: "https://files.catbox.moe/imypy7.jpeg",
                    sourceUrl: "chat.whatsapp.com/FDPHwoJOH56BuNF5pWKXWo",
                    mediaType: 1,
                    renderLargerThumbnail: true
                }
            }
        });

        // Send Audio (Song) Below
        const audioUrl = "https://files.catbox.moe/w5rxls.mp3"; // URL of the audio file
        await zk.sendMessage(dest, {
            audio: { url: audioUrl },
            mimetype: 'audio/mpeg',
            ptt: true, // Send as voice note
        }, { quoted: ms });

    } catch (e) {
        console.error("ğŸ¥µğŸ¥µ Menu error: ", e);
        repondre("ğŸ¥µğŸ¥µ An error occurred: " + e);
    }
});
